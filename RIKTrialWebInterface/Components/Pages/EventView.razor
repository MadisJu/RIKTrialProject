@page "/events/{EventId:guid}"

@using RIKTrialSharedModels.Domain.Returns
@using RIKTrialSharedModels.Domain.Types
@using RIKTrialWebInterface.Components.Comps

@inject EventAPIService EventApi
@inject NavigationManager Nav

<PageTitle>Ürituse Vaade</PageTitle>

@if (_event == null)
{
    <p>Loading...</p>
}
else
{
    <Banner BannerTitle="Üritus"/>

    <div class="Form-Body">

        <div class="Form-Card">

            <h2>Ürituse Andmed</h2>

            <div class="Form-Row">
                <label>Kuupäev</label>
                <span>@_event.Date.ToString("dd.MM.yyyy HH:mm")</span>
            </div>

            <div class="Form-Row">
                <label>Asukoht</label>
                <span>@_event.Location</span>
            </div>

            @if (!string.IsNullOrWhiteSpace(_event.AdditionalInfo))
            {
                <div class="Form-Row">
                    <label>Lisainfo</label>
                    <span>@_event.AdditionalInfo</span>
                </div>
            }

            <h2 class="Section-Title">Osalejad</h2>

            @if (_event.Participants.Count == 0)
            {
                <p>Osalejaid pole veel lisatud.</p>
            }
            else
            {
                <div class="Participant-List">
                    @foreach (ParticipantLightReturnDTO p in _event.Participants)
                    {
                        <ParticipantCardLight
                            Participant="p"
                            />
                    }
                </div>
            }

            <div class="form-actions">
                <button class="btn btn--secondary"
                        @onclick="NavigateBack">
                    Tagasi
                </button>
            </div>

        </div>
    </div>
}

@code
{
    [Parameter]
    public Guid EventId { get; set; }

    private EventDetailedReturnDTO? _event;

    protected override async Task OnInitializedAsync()
    {
        _event = await EventApi.GetEvent(EventId);
    }

    private void NavigateBack()
    {
        Nav.NavigateTo("/");
    }
}
